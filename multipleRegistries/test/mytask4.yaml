version: v1.0.0
steps:
  # build target image
- build: -t {{.Run.Registry}}/hello-world:{{.Run.Branch}}-{{.Run.Commit}} -f hello-world.dockerfile .
  # Tag as latest image in second registry
- cmd: docker tag {{.Run.Registry}}/hello-world:{{.Run.Branch}}-{{.Run.Commit}} {{.Values.regLatest}}/hello-world:latest
  # push images 
- push:
  - {{.Run.Registry}}/hello-world:{{.Run.Branch}}-{{.Run.Commit}}
  - {{.Values.regLatest}}/hello-world:latest